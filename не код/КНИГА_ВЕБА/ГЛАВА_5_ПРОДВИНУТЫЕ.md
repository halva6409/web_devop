# üìñ –ì–õ–ê–í–ê 5: –ü–†–û–î–í–ò–ù–£–¢–´–ï –í–û–ó–ú–û–ñ–ù–û–°–¢–ò

## üéØ –¶–µ–ª—å —ç—Ç–æ–π –≥–ª–∞–≤—ã
–¢—ã –ø–æ–π–º—ë—à—å:
- –ö–∞–∫ –∑–∞–≥—Ä—É–∂–∞—Ç—å —Ñ–∞–π–ª—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∑–∞–≥—Ä—É–∑–æ–∫
- –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å)
- –°–µ—Å—Å–∏–∏ –∏ –∫—É–∫–∏
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

---

## üì§ –ß–ê–°–¢–¨ 1: –ó–ê–ì–†–£–ó–ö–ê –§–ê–ô–õ–û–í

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤

```
–ë—Ä–∞—É–∑–µ—Ä (—Å —Ñ–∞–π–ª–æ–º)
        ‚Üì (multipart/form-data)
–§–æ—Ä–º–∞ HTML —Å input[type="file"]
        ‚Üì
Flask —Å–µ—Ä–≤–µ—Ä
        ‚Üì (–ø—Ä–æ–≤–µ—Ä–∫–∞, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ)
–ü–∞–ø–∫–∞ –Ω–∞ –¥–∏—Å–∫–µ —Å–µ—Ä–≤–µ—Ä–∞
        ‚Üì
–°—Å—ã–ª–∫–∞ –Ω–∞ —Ñ–∞–π–ª
```

### HTML —Ñ–æ—Ä–º–∞ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏

```html
<!-- –í–∞–∂–Ω–æ: enctype="multipart/form-data" -->
<form action="/upload" method="POST" enctype="multipart/form-data">
    <input type="file" name="file" required>
    <input type="file" name="image" accept="image/*">  <!-- –¢–æ–ª—å–∫–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è -->
    <button type="submit">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
</form>
```

### Flask –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–æ–∫

```python
from flask import Flask, request
from werkzeug.utils import secure_filename
import os

app = Flask(__name__)

# –ö–æ–Ω—Ñ–∏–≥–∏
app.config['UPLOAD_FOLDER'] = 'uploads'
app.config['MAX_CONTENT_LENGTH'] = 16 * 1024 * 1024  # 16 –ú–ë –º–∞–∫—Å–∏–º—É–º
ALLOWED_EXTENSIONS = {'txt', 'pdf', 'jpg', 'jpeg', 'png', 'gif'}

def allowed_file(filename):
    """–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ñ–∞–π–ª –∏–º–µ–µ—Ç —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ"""
    return '.' in filename and filename.rsplit('.', 1)[1].lower() in ALLOWED_EXTENSIONS

@app.route('/upload', methods=['GET', 'POST'])
def upload_file():
    if request.method == 'POST':
        # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ñ–∞–π–ª –≤ –∑–∞–ø—Ä–æ—Å–µ
        if 'file' not in request.files:
            return {'error': '–§–∞–π–ª –Ω–µ –≤—ã–±—Ä–∞–Ω'}, 400
        
        file = request.files['file']
        
        # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±—Ä–∞–ª —Ñ–∞–π–ª
        if file.filename == '':
            return {'error': '–ü—É—Å—Ç–æ–π —Ñ–∞–π–ª'}, 400
        
        # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ
        if not allowed_file(file.filename):
            return {'error': '–ù–µ—Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–π —Ç–∏–ø —Ñ–∞–π–ª–∞'}, 400
        
        try:
            # secure_filename —É–±–∏—Ä–∞–µ—Ç –æ–ø–∞—Å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã
            filename = secure_filename(file.filename)
            
            # –°–æ–∑–¥–∞—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è (—á—Ç–æ–± –Ω–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç—å)
            import uuid
            unique_filename = f"{uuid.uuid4()}_{filename}"
            
            # –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ñ–∞–π–ª
            filepath = os.path.join(app.config['UPLOAD_FOLDER'], unique_filename)
            file.save(filepath)
            
            return {
                'message': '–§–∞–π–ª —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω',
                'filename': unique_filename,
                'url': f'/uploads/{unique_filename}'
            }
        
        except Exception as e:
            return {'error': f'–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏: {str(e)}'}, 500
    
    return render_template('upload.html')

# –ü–æ–∑–≤–æ–ª–∏—Ç—å —Å–∫–∞—á–∏–≤–∞—Ç—å –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
@app.route('/uploads/<filename>')
def uploaded_file(filename):
    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —ç—Ç–æ —Ä–µ–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª (–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å!)
    filepath = os.path.join(app.config['UPLOAD_FOLDER'], filename)
    if not os.path.exists(filepath):
        return '–§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω', 404
    
    return send_file(filepath)
```

### AJAX –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ (–±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏)

```html
<form id="upload-form">
    <input type="file" id="file-input" required>
    <button type="submit">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
    <div id="progress"></div>
    <div id="result"></div>
</form>

<script>
let form = document.getElementById('upload-form');
let result = document.getElementById('result');

form.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    let file = document.getElementById('file-input').files[0];
    if (!file) return;
    
    // –°–æ–∑–¥–∞—Ç—å –æ–±—ä–µ–∫—Ç FormData –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–∞–π–ª–∞
    let formData = new FormData();
    formData.append('file', file);
    
    result.textContent = '–ó–∞–≥—Ä—É–∂–∞—é...';
    
    try {
        let response = await fetch('/upload', {
            method: 'POST',
            body: formData  // –ù–µ –¥–æ–±–∞–≤–ª—è–π Content-Type!
        });
        
        let data = await response.json();
        
        if (response.ok) {
            result.innerHTML = `
                <p style="color: green;">–£—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ!</p>
                <img src="${data.url}" style="max-width: 300px;">
            `;
            form.reset();
        } else {
            result.textContent = `–û—à–∏–±–∫–∞: ${data.error}`;
        }
    } catch (error) {
        result.textContent = `–û—à–∏–±–∫–∞: ${error.message}`;
    }
});
</script>
```

### –ó–∞–≥—Ä—É–∑–∫–∞ —Å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å–∞

```javascript
let form = document.getElementById('upload-form');
let progressBar = document.getElementById('progress-bar');

form.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    let file = document.getElementById('file-input').files[0];
    let formData = new FormData();
    formData.append('file', file);
    
    let xhr = new XMLHttpRequest();
    
    // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
    xhr.upload.addEventListener('progress', (e) => {
        if (e.lengthComputable) {
            let percent = (e.loaded / e.total) * 100;
            progressBar.style.width = percent + '%';
            progressBar.textContent = Math.round(percent) + '%';
        }
    });
    
    xhr.addEventListener('load', () => {
        if (xhr.status === 200) {
            alert('–§–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω —É—Å–ø–µ—à–Ω–æ!');
        }
    });
    
    xhr.open('POST', '/upload');
    xhr.send(formData);
});
```

---

## üîê –ß–ê–°–¢–¨ 2: –ê–£–¢–ï–ù–¢–ò–§–ò–ö–ê–¶–ò–Ø –ò –ü–ê–†–û–õ–ò

### –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π

```
‚ùå –û–ü–ê–°–ù–û (–Ω–∏–∫–æ–≥–¥–∞ —Ç–∞–∫ –Ω–µ –¥–µ–ª–∞–π!):
users.db
id | username | password
1  | ivan     | 123456       ‚Üê –ï—Å–ª–∏ –±–∞–∑–∞ —É–∫—Ä–∞–¥–µ–Ω–∞, –≤—Å–µ –ø–∞—Ä–æ–ª–∏ –≤–∏–¥–Ω—ã!

‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û:
id | username | password_hash
1  | ivan     | $2b$12$abcdef...  ‚Üê –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –ø–∞—Ä–æ–ª—å
```

**–ò—Å–ø–æ–ª—å–∑—É–π –±–∏–±–ª–∏–æ—Ç–µ–∫—É werkzeug:**

```python
from werkzeug.security import generate_password_hash, check_password_hash

# –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å (–ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏)
password_hash = generate_password_hash("mySuperPassword123")
# '$2b$12$N9qo8uLOickgx2ZMRZoMyeIjZAgcg7b3XeKeUxWdeS86U7tS37FzS'

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–∞—Ä–æ–ª—å (–ø—Ä–∏ –≤—Ö–æ–¥–µ)
is_correct = check_password_hash(password_hash, "mySuperPassword123")  # True
is_correct = check_password_hash(password_hash, "wrongPassword")        # False
```

### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```python
from flask import Flask, request, jsonify
from werkzeug.security import generate_password_hash
import sqlite3

@app.route('/api/register', methods=['POST'])
def register():
    data = request.json
    
    username = data.get('username', '').strip()
    email = data.get('email', '').strip()
    password = data.get('password', '')
    
    # –í–∞–ª–∏–¥–∞—Ü–∏—è
    if not username or len(username) < 3:
        return {'error': '–ò–º—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–∏–Ω–∏–º—É–º 3 —Å–∏–º–≤–æ–ª–∞'}, 400
    
    if not email or '@' not in email:
        return {'error': '–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email'}, 400
    
    if not password or len(password) < 6:
        return {'error': '–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤'}, 400
    
    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –µ—â—ë –Ω–µ—Ç
    db = sqlite3.connect('app.db')
    cursor = db.cursor()
    cursor.execute('SELECT id FROM users WHERE username = ? OR email = ?',
                   (username, email))
    
    if cursor.fetchone():
        return {'error': '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç'}, 409
    
    # –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    password_hash = generate_password_hash(password)
    cursor.execute('''
        INSERT INTO users (username, email, password_hash)
        VALUES (?, ?, ?)
    ''', (username, email, password_hash))
    
    db.commit()
    db.close()
    
    return {'message': '–£—Å–ø–µ—à–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω'}, 201
```

### –í—Ö–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–ª–æ–≥–∏–Ω)

```python
from werkzeug.security import check_password_hash

@app.route('/api/login', methods=['POST'])
def login():
    data = request.json
    
    username = data.get('username', '').strip()
    password = data.get('password', '')
    
    # –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    db = sqlite3.connect('app.db')
    cursor = db.cursor()
    cursor.execute('''
        SELECT id, username, password_hash FROM users
        WHERE username = ?
    ''', (username,))
    
    user = cursor.fetchone()
    db.close()
    
    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
    if not user:
        return {'error': '–ù–µ–≤–µ—Ä–Ω–æ–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è'}, 401
    
    user_id, username, password_hash = user
    
    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–∞—Ä–æ–ª—å
    if not check_password_hash(password_hash, password):
        return {'error': '–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å'}, 401
    
    # –£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥! –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ —Å–µ—Å—Å–∏—é
    session['user_id'] = user_id
    session['username'] = username
    
    return {
        'message': '–£—Å–ø–µ—à–Ω–æ –≤–æ—à–ª–∏',
        'user_id': user_id,
        'username': username
    }, 200
```

---

## ü™ë –ß–ê–°–¢–¨ 3: –°–ï–°–°–ò–ò –ò –ö–£–ö–ò

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç —Å–µ—Å—Å–∏–∏

```
–ë—Ä–∞—É–∑–µ—Ä                     –°–µ—Ä–≤–µ—Ä
‚îú‚îÄ –í—Ö–æ–¥ (username/password)
‚îÇ       ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí
‚îÇ       ‚Üê –°–æ–∑–¥–∞–Ω–∞ —Å–µ—Å—Å–∏—è
‚îÇ       ‚Üê ID —Å–µ—Å—Å–∏–∏ –≤ –∫—É–∫–µ
‚îú‚îÄ –ó–∞–ø—Ä–æ—Å—ã (—Å –∫—É–∫–æ–º)
‚îÇ       ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí
‚îÇ       (—Å–µ—Ä–≤–µ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç: "—ç—Ç–æ –ò–≤–∞–Ω")
‚îÇ       ‚Üê –î–∞–Ω–Ω—ã–µ –¥–ª—è –ò–≤–∞–Ω–∞
‚îÇ       ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí
‚îî‚îÄ –í—ã—Ö–æ–¥
        ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí
        ‚Üê –°–µ—Å—Å–∏—è —É–¥–∞–ª–µ–Ω–∞
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–µ—Å—Å–∏–π –≤ Flask

```python
from flask import Flask, session, redirect, url_for
from datetime import timedelta

app = Flask(__name__)
app.secret_key = '–º–æ–π-—Å–µ–∫—Ä–µ—Ç–Ω—ã–π-–∫–ª—é—á'  # –û—á–µ–Ω—å –≤–∞–∂–Ω–æ! –ò—Å–ø–æ–ª—å–∑—É–π —Å–∏–ª—å–Ω—ã–π –∫–ª—é—á
app.config['PERMANENT_SESSION_LIFETIME'] = timedelta(days=7)  # –ù–∞ –Ω–µ–¥–µ–ª—é

@app.route('/api/login', methods=['POST'])
def login():
    # ... –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ...
    
    # –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ —Å–µ—Å—Å–∏—é
    session['user_id'] = user_id
    session['username'] = username
    session['is_admin'] = user.is_admin
    session.permanent = True  # –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–∂–µ –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è –±—Ä–∞—É–∑–µ—Ä–∞
    
    return {'message': '–í–æ—à–ª–∏ —É—Å–ø–µ—à–Ω–æ'}

@app.route('/api/me')
def get_current_user():
    # –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ —Å–µ—Å—Å–∏–∏
    if 'user_id' not in session:
        return {'error': '–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–∏—Ä–æ–≤–∞–Ω'}, 401
    
    return {
        'user_id': session['user_id'],
        'username': session['username'],
        'is_admin': session.get('is_admin', False)
    }

@app.route('/api/logout')
def logout():
    # –£–¥–∞–ª–∏—Ç—å —Å–µ—Å—Å–∏—é
    session.clear()
    return {'message': '–í—ã—à–ª–∏'}
```

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (–î–µ–∫–æ—Ä–∞—Ç–æ—Ä)

```python
from functools import wraps

def login_required(f):
    """–î–µ–∫–æ—Ä–∞—Ç–æ—Ä: —Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏"""
    @wraps(f)
    def decorated_function(*args, **kwargs):
        if 'user_id' not in session:
            return {'error': '–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏'}, 401
        return f(*args, **kwargs)
    return decorated_function

@app.route('/api/my-news')
@login_required
def my_news():
    # –¢–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ä–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –≤–∏–¥–µ—Ç—å —ç—Ç–æ
    user_id = session['user_id']
    
    db = sqlite3.connect('app.db')
    cursor = db.cursor()
    cursor.execute('''
        SELECT id, title, created_at
        FROM user_news
        WHERE user_id = ?
        ORDER BY created_at DESC
    ''', (user_id,))
    
    news = cursor.fetchall()
    db.close()
    
    return {'news': [dict(zip(['id', 'title', 'date'], row)) for row in news]}

# –ü–æ—Ö–æ–∂–∏–π –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
def admin_required(f):
    @wraps(f)
    def decorated_function(*args, **kwargs):
        if 'user_id' not in session or not session.get('is_admin'):
            return {'error': '–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã'}, 403
        return f(*args, **kwargs)
    return decorated_function

@app.route('/api/admin/users')
@admin_required
def admin_users():
    # –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã
    ...
```

### –ö—É–∫–∏ (–¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞)

```python
from flask import make_response

@app.route('/set-cookie')
def set_cookie():
    response = make_response('–ö—É–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞')
    
    # –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫—É–∫—É
    response.set_cookie('my_cookie', 'value_123', 
                       max_age=86400)  # –ù–∞ 1 –¥–µ–Ω—å
    
    return response

@app.route('/read-cookie')
def read_cookie():
    # –ü–æ–ª—É—á–∏—Ç—å –∫—É–∫—É
    my_cookie = request.cookies.get('my_cookie')
    return {'cookie': my_cookie}
```

---

## ‚ö° –ß–ê–°–¢–¨ 4: –ö–≠–®–ò–†–û–í–ê–ù–ò–ï

### –ü–æ—á–µ–º—É –Ω—É–∂–µ–Ω –∫—ç—à?

```
–°–ª–æ–∂–Ω—ã–π –∑–∞–ø—Ä–æ—Å –≤ –ë–î: SELECT ... WHERE ... JOIN ... GROUP BY ...
–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: 2 —Å–µ–∫—É–Ω–¥—ã

‚ùå –ë–µ–∑ –∫—ç—à–∞:
–ó–∞–ø—Ä–æ—Å 1 ‚Üí 2 —Å–µ–∫ –∂–¥—ë–º
–ó–∞–ø—Ä–æ—Å 2 ‚Üí 2 —Å–µ–∫ –∂–¥—ë–º (–æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ!)
–ó–∞–ø—Ä–æ—Å 3 ‚Üí 2 —Å–µ–∫ –∂–¥—ë–º
–í—Ä–µ–º—è –Ω–∞ 3 –∑–∞–ø—Ä–æ—Å–∞: 6 —Å–µ–∫—É–Ω–¥

‚úÖ –° –∫—ç—à–µ–º:
–ó–∞–ø—Ä–æ—Å 1 ‚Üí 2 —Å–µ–∫ –∂–¥—ë–º, —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –∫—ç—à
–ó–∞–ø—Ä–æ—Å 2 ‚Üí <1 –º—Å –∏–∑ –∫—ç—à–∞! (–ø–æ—á—Ç–∏ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ)
–ó–∞–ø—Ä–æ—Å 3 ‚Üí <1 –º—Å –∏–∑ –∫—ç—à–∞!
–í—Ä–µ–º—è –Ω–∞ 3 –∑–∞–ø—Ä–æ—Å–∞: 2+ —Å–µ–∫—É–Ω–¥ (—É—Å–∫–æ—Ä–∏–ª–∏ –≤ 3 —Ä–∞–∑–∞!)
```

### –ü—Ä–æ—Å—Ç–æ–π –∫—ç—à –≤ –ø–∞–º—è—Ç–∏

```python
from flask import Flask
import json

app = Flask(__name__)
cache = {}  # –ü—Ä–æ—Å—Ç–æ–π –∫—ç—à

@app.route('/api/top-news')
def get_top_news():
    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫—ç—à
    if 'top_news' in cache:
        return cache['top_news']
    
    # –í—ã—á–∏—Å–ª–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    db = sqlite3.connect('app.db')
    cursor = db.cursor()
    cursor.execute('''
        SELECT id, title, source
        FROM news
        WHERE is_archived = 0
        ORDER BY views DESC
        LIMIT 10
    ''')
    
    news = [dict(zip(['id', 'title', 'source'], row)) 
            for row in cursor.fetchall()]
    db.close()
    
    result = {'news': news}
    
    # –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –∫—ç—à
    cache['top_news'] = result
    
    return result

# –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à (–∫–æ–≥–¥–∞ –¥–æ–±–∞–≤–∏–ª–∏ –Ω–æ–≤–æ—Å—Ç—å)
@app.route('/api/news', methods=['POST'])
def create_news():
    # ... –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ—Å—Ç—å ...
    
    # –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à
    cache.pop('top_news', None)
    
    return {'message': '–ù–æ–≤–æ—Å—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∞'}
```

### –ö—ç—à —Å –≤—Ä–µ–º–µ–Ω–µ–º –∂–∏–∑–Ω–∏

```python
from datetime import datetime, timedelta

class CacheWithExpiry:
    def __init__(self):
        self.data = {}
        self.expiry = {}
    
    def set(self, key, value, expires_in_seconds=300):
        """–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –∫—ç—à —Å –≤—Ä–µ–º–µ–Ω–µ–º –∂–∏–∑–Ω–∏"""
        self.data[key] = value
        self.expiry[key] = datetime.now() + timedelta(seconds=expires_in_seconds)
    
    def get(self, key):
        """–ü–æ–ª—É—á–∏—Ç—å –∏–∑ –∫—ç—à–∞ (–µ—Å–ª–∏ –Ω–µ –∏—Å—Ç—ë–∫)"""
        if key not in self.data:
            return None
        
        # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –Ω–µ –∏—Å—Ç—ë–∫
        if datetime.now() > self.expiry.get(key):
            del self.data[key]
            return None
        
        return self.data[key]

cache = CacheWithExpiry()

@app.route('/api/top-news')
def get_top_news():
    result = cache.get('top_news')
    if result:
        return result
    
    # ... –≤—ã—á–∏—Å–ª–∏—Ç—å ...
    
    # –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞ 5 –º–∏–Ω—É—Ç
    cache.set('top_news', result, expires_in_seconds=300)
    return result
```

### –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –∫—ç—à Flask (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```python
from flask_caching import Cache

app = Flask(__name__)
app.config['CACHE_TYPE'] = 'simple'  # –ò–ª–∏ 'redis', 'memcached'
cache = Cache(app)

@app.route('/api/top-news')
@cache.cached(timeout=300)  # –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ 5 –º–∏–Ω—É—Ç
def get_top_news():
    # –≠—Ç–æ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –±—É–¥–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω
    ...

@app.route('/api/news', methods=['POST'])
def create_news():
    # ... –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ—Å—Ç—å ...
    
    # –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à
    cache.delete('top_news')
    
    return {'message': '–ù–æ–≤–æ—Å—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∞'}
```

---

## üõ°Ô∏è –ß–ê–°–¢–¨ 5: –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨

### –¢–∏–ø–∏—á–Ω—ã–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏

| –£—è–∑–≤–∏–º–æ—Å—Ç—å | –û–ø–∞—Å–Ω–æ—Å—Ç—å | –†–µ—à–µ–Ω–∏–µ |
|-----------|----------|--------|
| **SQL Injection** | –ö—Ç–æ-—Ç–æ –≤–≤–æ–¥–∏—Ç SQL –∫–æ–¥ –≤–º–µ—Å—Ç–æ –¥–∞–Ω–Ω—ã—Ö | –ò—Å–ø–æ–ª—å–∑—É–π –ø–∞—Ä–∞–º–µ—Ç—Ä—ã `?` –≤ –∑–∞–ø—Ä–æ—Å–∞—Ö |
| **XSS (Cross-Site Scripting)** | JS –∫–æ–¥ –≤ –≤–≤–æ–¥–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è | –≠–∫—Ä–∞–Ω–∏—Ä—É–π HTML (Jinja2 –¥–µ–ª–∞–µ—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) |
| **CSRF (Cross-Site Request Forgery)** | –°–∞–π—Ç –¥–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –æ—Ç –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è | –ò—Å–ø–æ–ª—å–∑—É–π CSRF —Ç–æ–∫–µ–Ω—ã |
| **–û—Ç–∫—Ä—ã—Ç—ã–µ –ø–∞—Ä–æ–ª–∏** | –ü–∞—Ä–æ–ª–∏ –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ –≤ –ë–î | –•–µ—à–∏ –ø–∞—Ä–æ–ª–µ–π (werkzeug.security) |
| **Session hijacking** | –ö—Ç–æ-—Ç–æ –∫—Ä–∞–¥—ë—Ç —Å–µ—Å—Å–∏—é | –ò—Å–ø–æ–ª—å–∑—É–π HTTPS, SameSite –∫—É–∫–∏ |

### CSRF –∑–∞—â–∏—Ç–∞ –≤ Flask

```python
from flask_wtf.csrf import CSRFProtect
from flask_wtf import FlaskForm
from wtforms import StringField, PasswordField

csrf = CSRFProtect(app)

# –í —Ñ–æ—Ä–º–µ HTML (Jinja2)
<form action="/login" method="POST">
    {{ csrf_token() }}  ‚Üê –î–æ–±–∞–≤–∏—Ç—å CSRF —Ç–æ–∫–µ–Ω
    <input type="text" name="username">
    <input type="password" name="password">
    <button>–í—Ö–æ–¥</button>
</form>

# –í AJAX
let token = document.querySelector('meta[name="csrf-token"]')?.content;

fetch('/api/login', {
    method: 'POST',
    headers: {
        'Content-Type': 'application/json',
        'X-CSRFToken': token  ‚Üê –û—Ç–ø—Ä–∞–≤–∏—Ç—å CSRF —Ç–æ–∫–µ–Ω
    },
    body: JSON.stringify({username, password})
});
```

### HTTPS –∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∫—É–∫–∏

```python
# –í production –æ–∫—Ä—É–∂–µ–Ω–∏–∏
if not app.debug:
    app.config['SESSION_COOKIE_SECURE'] = True   # –¢–æ–ª—å–∫–æ HTTPS
    app.config['SESSION_COOKIE_HTTPONLY'] = True # –ù–µ –¥–æ—Å—Ç—É–ø–Ω–æ JS (–æ—Ç XSS)
    app.config['SESSION_COOKIE_SAMESITE'] = 'Lax' # –û—Ç CSRF
```

---

## üéì –ò–¢–û–ì–ò

–ü–æ—Å–ª–µ —ç—Ç–æ–π –≥–ª–∞–≤—ã —Ç—ã –∑–Ω–∞–µ—à—å:
- ‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∑–∞–≥—Ä—É–∑–æ–∫
- ‚úÖ –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π
- ‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –≤—Ö–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –°–µ—Å—Å–∏–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ –î–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã –¥–ª—è —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- ‚úÖ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏
- ‚úÖ –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∏–ø—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

**–í–µ—á–µ—Ä–æ–º –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ —Ç—ã:**
- –°–æ–∑–¥–∞—à—å –∑–∞–≥—Ä—É–∑–∫—É —Ñ–∞–π–ª–æ–≤
- –î–æ–±–∞–≤–∏—à—å —Å–∏—Å—Ç–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- –†–µ–∞–ª–∏–∑—É–µ—à—å –≤—Ö–æ–¥ –∏ –≤—ã—Ö–æ–¥
- –ó–∞—â–∏—Ç–∏—à—å –º–∞—Ä—à—Ä—É—Ç—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π
- –î–æ–±–∞–≤–∏—à—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
- –¢–µ—Å—Ç–∏—Ä—É–µ—à—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

---

**–ü–æ–º–Ω–∏:** –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —ç—Ç–æ –Ω–µ —Å–ø–æ—Ä—Ç, —ç—Ç–æ –Ω–∞—É–∫–∞! üîê
